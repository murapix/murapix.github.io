function x({acceptedOrigins:a,supportsSaving:P,supportsSaveManager:y,ignoreApiVersion:b,onLoggedInChanged:k}){return new Promise((j,m)=>{if(a=a!=null?a:["https://galaxy.click"],a.includes(document.referrer)){let f,d;const l={},c={},s={acceptedOrigins:a,supportsSaving:P,supportsSaveManager:y,ignoreApiVersion:b,onLoggedInChanged:k,origin:window.origin,apiVersion:0,loggedIn:!1,postMessage:function(e){var n;(n=window.top)==null||n.postMessage(e,s.origin)},getSaveList:function(){return f!=null||d!=null?Promise.reject("save_list action already in progress."):(s.postMessage({action:"save_list"}),new Promise((e,n)=>{f=e,d=n}))},save:function(e,n,t){return e in l?Promise.reject(`save action for slot ${e} already in progress.`):(s.postMessage({action:"save",slot:e,content:n,label:t}),new Promise((u,v)=>{l[e]={accept:u,reject:v}}))},load:function(e){return e in c?Promise.reject(`load action for slot ${e} already in progress.`):(s.postMessage({action:"load",slot:e}),new Promise((n,t)=>{c[e]={accept:n,reject:t}}))}};window.addEventListener("message",e=>{var n,t,u,v,w;if(e.origin===s.origin){console.log("Received message from Galaxy",e.data);const g=e.data;switch(g.type){case"info":{const{galaxy:i,api_version:r,logged_in:o}=g;if(r!==1&&s.ignoreApiVersion!==!0)m(`API version not recognized: ${r}`);else{const p=s.apiVersion===0;s.apiVersion=r,s.loggedIn=o,s.origin=e.origin,p?j(s):(n=s.onLoggedInChanged)==null||n.call(s,s)}break}case"save_list":{const{list:i,error:r,message:o}=g;r===!0?d(o):f(i),f=d=null;break}case"save_content":{const{content:i,label:r,slot:o,error:p,message:_}=g;p===!0?(t=c[o])==null||t.reject(_):(u=c[o])==null||u.accept({slot:o,content:i,label:r}),delete c[o];break}case"saved":{const{slot:i,error:r,message:o}=g;r===!0?(v=l[i])==null||v.reject(o):(w=l[i])==null||w.accept(i),delete l[i];break}}}})}else m(`Project is not running on an accepted origin: ${window.origin}`)})}export{x as i};
